<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta property="og:site_name" content="Hot Term 熱門關鍵字" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Hot Term 熱門關鍵字" />
    <meta property="og:url" content="" />
    <meta property="og:description" content="" />
    <title>Hot Term</title>

    <!-- Bootstrap core CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.1.3/litera/bootstrap.min.css" rel="stylesheet" integrity="sha384-JuAGGg3c8UPrWdf0N8ZPJyOHkACruI9+mbl0C+H6XSYOqv9xIdiUSKehRyA8jUol"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.15/marked.min.js"></script>
    <style type="text/css">
        .ui-btn-top {
            position: fixed;
            bottom: 20px;
            right: 5px;
        }

        .display-3 {
            margin-top: 20px;
        }

        .anchor::before {
            display: block;
            content: " ";
            margin-top: -60px;
            height: 60px;
            visibility: hidden;
            pointer-events: none;
        }
    </style>
</head>

<body>


    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="/list.html">Hot Term</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
            </ul>
            <!--
          <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form>
          -->
        </div>
    </nav>

    <main role="main">
        <!-- Main jumbotron for a primary marketing message or call to action -->
        <div class="jumbotron">
            <div class="container">
                <h1 class="display-3">Hot Term</h1>
                <!--
                <p>This is a template for a simple marketing or informational website. It includes a large callout called a
                    jumbotron and three supporting pieces of content. Use it as a starting point to create something more
                    unique.</p>
                <p>
                    <a class="btn btn-primary btn-lg" href="#" role="button">Learn more &raquo;</a>
                </p>
                -->
            </div>
        </div>
        <div class="container" id="content">
            <hr>
        </div>

        <!-- /container -->
        <button type="button" class="btn btn-info ui-btn-top">
            <span class="glyphicon glyphicon-arrow-up"></span>UP
        </button>
    </main>

    <footer class="container">
        <p>&copy; Hot Term 2018</p>
    </footer>
    <script type="text/javascript">
        (function () {
            var urlParams = new URLSearchParams(window.location.search);
            var date = new Date();
            date.setMinutes(date.getMinutes() - 6);
            if (urlParams.has('d')) {
                var queryd = urlParams.get('d');
                var url = geturl(queryd.slice(0, 4) + '/' + queryd.slice(4, 6) + '/' + queryd.slice(6, 8) + '/' + queryd);
            } else {
                var queryd = dateToYMD(date).slice(-11);
                var url = geturl(dateToYMD(date));
            }
            $("meta[property='og:url']").attr("content", "http://peicheng.github.io/" + window.location.pathname + "?" + urlParams);
            $("meta[property='og:title']").attr("content", queryd.slice(0, 8) + ' ' + queryd.slice(9) + '時 熱門關鍵字');

            //$('meta[property="og\\:title"]').attr("content", "http://peicheng.github.io/"+window.location.pathname + "?" + urlParams);

            var toc = document.createElement('div');
            toc.className = "toc";
            var block = document.createElement('div');
            block.className = "row";
            var colmd1_div = document.createElement('div');
            colmd1_div.className = "col-md-1";
            //block.appendChild(colmd1_div);
            var list_div = document.createElement('div');
            list_div.className = "col-md-10";
            list_div.setAttribute("id", "termblock");

            var terms_list = new Array();
            var title_list = new Array();
            $.get(url, function (data, status) {
                console.log('info: ' + data.indexOf('\n'));
                if (data.indexOf('\n') == -1) {
                    //'old'
                    var splitflag = false;
                    var lines = data.split('{"term"');
                } else {
                    var splitflag = true;
                    var lines = data.split('\n');
                }

                lines.forEach(function (line, index) {
                    try {
                        if (splitflag) {
                            var j = JSON.parse(line);
                        } else {
                            var j = JSON.parse('{"term"' + line);
                        }
                        terms_list.push(j);
                        let title = document.createElement('h2');
                        title.setAttribute("id", "title" + index);
                        title.className = "anchor";
                        title.innerText = j.term
                        list_div.appendChild(title);
                        title_list.push(j.term);

                        let summary = document.createElement('p');
                        summary.innerText = j.summary;
                        list_div.appendChild(summary);

                        let links_ul = document.createElement('ul');
                        j.links.forEach(function (l) {
                            let li = document.createElement('li');
                            li.innerHTML = "<a href='" + l.url + "' target='_blank'> " + l.title + "</a> " + l.t;
                            links_ul.appendChild(li);
                        });
                        list_div.appendChild(links_ul);
                        //toc
                        toc.innerHTML += "<a href='#title" + index + "'>" + j.term + "</a><br>";

                    } catch (e) {
                        console.log('line ' + line);
                        console.log(e);
                    }
                });
                $("meta[property='og:description']").attr("content", title_list.join(" ") + " 熱門關鍵字");
                var m = document.createElement('meta');
                m.name = 'description';
                m.content = title_list.join(" ") + " 熱門關鍵字";
                document.head.appendChild(m);
            }).fail(function () {
                //alert('zzz' + status);
            });
            var sidebar = document.createElement('div');
            sidebar.className = "col-md-2";
            sidebar.setAttribute("id", "sidebar");
            block.appendChild(list_div);
            block.appendChild(sidebar);
            $('#content').append(block);
            $('#content').prepend(toc);
            genTodayListToSidebar(queryd);
            genThisMonthDayListToSidebar(getThisMonthDayList());
            //add headline
            $('#termblock').prepend('<h1>' + queryd.slice(0, 8) + ' ' + queryd.slice(9) + '時 熱門關鍵字</h1>');

            if (urlParams.has('d')) {
            } else {
                urlParams.append('d', queryd)
            }
            window.history.pushState(null, null, window.location.pathname + "?" + urlParams);
            document.title = "Hot Term " + queryd;


        })();
        function genContent(term_list) {
            term_list.forEach(function (d) {

            });
        }
        function dateToYMD(date) {
            var d = date.getDate();
            var m = date.getMonth() + 1; //Month from 0 to 11
            var y = date.getFullYear();
            var h = date.getHours();
            m = (m <= 9 ? '0' + m : m);
            d = (d <= 9 ? '0' + d : d);
            h = (h <= 9 ? '0' + h : h);
            return y + '/' + m + '/' + d + '/' + y + m + '' + d + '_' + h;
        }
        function geturl(d) {
            var url_prefix = "https://raw.githubusercontent.com/peicheng/hotterm/master/";
            return url_prefix + d + '_hotterm.json'
        }
        $(document).ready(function () {
            $(document).on('click', '.ui-btn-top', function (evt) {
                evt.preventDefault();
                $('html, body').animate({ scrollTop: 0 }, 300); //http://api.jquery.com/animate/
            });
        });
        function getDayLinks() {
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth();
            var yyyy = today.getFullYear();
            /*
            if(dd<10){
                dd = '0'+dd
            } 
            if(mm<10){
                mm = '0'+mm
            } */
            console.log(yyyy + ' ' + mm)
            //console.log(getDaysInMonth(4, 2012))
            console.log(getDaysInMonth(mm, yyyy))

        }
        function getThisMonthDayList() {
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth();
            var yyyy = today.getFullYear();
            return getDaysInMonth(mm, yyyy);
        }
        /**
        * @param {int} The month number, 0 based
        * @param {int} The year, not zero based, required to account for leap years
        * @return {Date[]} List with date objects for each day of the month
        */
        function getDaysInMonth(month, year) {
            // Since no month has fewer than 28 days
            var date = new Date(year, month, 1);
            var days = [];
            console.log('month', month, 'date.getMonth()', date.getMonth())
            var m = month + 1;
            while (date.getMonth() === month) {
                //days.push(new Date(date));
                days.push(year + "" + (m < 10 ? '0' : '') + m + "" + (date.getDate() < 10 ? '0' : '') + date.getDate());
                date.setDate(date.getDate() + 1);
            }
            return days;
        }
        function genTodayListToSidebar(queryd) {
            $('#sidebar').append("<div id='todaylist'><h3>本日熱門</h3><ul></ul></div>");
            let todaydiv = $("#todaylist").find('ul');;
            //20181012_01
            for (i = 0; i < 24; i++) {
                let link = window.location.pathname + "?d=" + queryd.slice(0, 8) + "_" + (i < 10 ? "0" + i : i);
                let text = queryd.slice(0, 4) + '-' + queryd.slice(4, 6) + '-' + queryd.slice(6, 8) + " " + (i < 10 ? "0" + i : i);
                todaydiv.append("<li><a href='" + link + "'>" + text + "</a></li>");
            }
            $('#sidebar').append(todaydiv);

        }
        function genThisMonthDayListToSidebar(daylist) {
            //queryd 20181010
            $('#sidebar').append("<div id='thismonthlist'><h3>本月熱門</h3><ul></ul></div>");
            let todaydiv = $("#thismonthlist").find('ul');;
            //20181012_01
            daylist.forEach(function (queryd) {
                let link = window.location.pathname + "?d=" + queryd.slice(0, 8) + "_12";
                let text = queryd.slice(0, 4) + '-' + queryd.slice(4, 6) + '-' + queryd.slice(6, 8);
                todaydiv.append("<li><a href='" + link + "'>" + text + "</a></li>");
            });
            $('#sidebar').append(todaydiv);

        }
    </script>

</body>


</html>